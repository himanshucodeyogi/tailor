<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>
<body class="bg-gray-50 dark:bg-gray-900">
  <%- include('../partials/nav-public') %>

  <div class="max-w-7xl mx-auto px-4 py-8 sm:py-12">
    <%- include('../partials/flash') %>

    <!-- Hero Section -->
    <div class="text-center mb-8 sm:mb-12">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 dark:text-white mb-3 sm:mb-4">Welcome to Tailor Shop</h1>
      <p class="text-base sm:text-lg text-gray-600 dark:text-gray-400">Get your clothes custom-fitted to perfection</p>
    </div>

    <!-- Customer Track Order Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 sm:p-8 max-w-2xl mx-auto mb-12">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6">üõçÔ∏è Track Your Order</h2>
      <form action="/track" method="POST" class="space-y-4">
        <div>
          <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Enter Your Mobile Number</label>
          <input
            type="text"
            name="phone"
            placeholder="10-15 digits (e.g., 9876543210)"
            class="w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
            required
          />
        </div>
        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 sm:py-3 rounded text-sm sm:text-base transition"
        >
          Track Order
        </button>
      </form>
    </div>

    <!-- Order Results -->
    <% if (typeof trackResults !== 'undefined' && trackResults) { %>
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 sm:p-8 max-w-4xl mx-auto mb-12">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6">
          Order Status for <%= trackResults.customer.name %>
        </h3>

        <% trackResults.orders.forEach((order, i) => { %>
          <div class="mb-6 sm:mb-8">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-4 mb-4 sm:mb-6">
              <h4 class="text-base sm:text-lg font-semibold text-gray-700 dark:text-gray-300">Order #<%= order.orderNumber %></h4>
              <span class="text-xs sm:text-sm text-gray-500 dark:text-gray-400"><%= order.garmentType %></span>
            </div>

            <!-- 5-Step Stepper - Mobile Friendly -->
            <div class="flex items-center justify-between mb-4 sm:mb-8 overflow-x-auto pb-2">
              <%
                const statuses = [
                  'Order Placed',
                  'Cutting',
                  'In Stitching',
                  'Final Touches',
                  'Ready for Pickup'
                ];
                const currentIndex = statuses.indexOf(order.status);
              %>
              <% statuses.forEach((step, i) => { %>
                <div class="flex flex-col items-center flex-shrink-0">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center text-xs sm:text-sm font-bold <%= currentIndex >= i ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600' %>">
                    <%= i + 1 %>
                  </div>
                  <span class="text-xs mt-1 sm:mt-2 text-center w-16 sm:w-24 font-medium <%= currentIndex >= i ? 'text-blue-600' : 'text-gray-400' %>">
                    <%= step.split(' ')[0] %>
                  </span>
                </div>
                <% if (i < statuses.length - 1) { %>
                  <div class="flex-1 h-1 mx-1 sm:mx-2 flex-shrink-0 <%= currentIndex > i ? 'bg-blue-600' : 'bg-gray-300' %>"></div>
                <% } %>
              <% }) %>
            </div>

            <div class="grid grid-cols-2 gap-2 sm:gap-4 text-xs sm:text-sm">
              <div>
                <span class="text-gray-600 dark:text-gray-400 text-xs">Created:</span>
                <p class="font-semibold text-gray-900 dark:text-white"><%= new Date(order.createdAt).toLocaleDateString() %></p>
              </div>
              <div>
                <span class="text-gray-600 dark:text-gray-400 text-xs">Due Date:</span>
                <p class="font-semibold text-gray-900 dark:text-white"><%= order.dueDate ? new Date(order.dueDate).toLocaleDateString() : 'Not set' %></p>
              </div>
            </div>

            <% if (i < trackResults.orders.length - 1) { %>
              <hr class="my-6 sm:my-8 border-gray-300 dark:border-gray-600">
            <% } %>
          </div>
        <% }) %>
      </div>
    <% } %>

    <% if (typeof trackError !== 'undefined' && trackError) { %>
      <div class="bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-600 text-yellow-700 dark:text-yellow-200 px-4 py-3 rounded max-w-2xl mx-auto mb-12">
        <p><strong>Info:</strong> <%= trackError %></p>
      </div>
    <% } %>
  </div>

  <%- include('../partials/footer') %>
</body>
</html>
